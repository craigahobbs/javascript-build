npm install --save-dev c8@'~X.Y' eslint@'~X.Y' @eslint/js@'~X.Y' globals jsdoc@'~X.Y'
mkdir -p build/
touch build/npm.build
node --test --test-reporter spec $(node -e 'console.log(process.version < "v22.0.0" ? "test/" : "test/**/*.js")')
npx eslint eslint.config.js lib/ test/
npx jsdoc --pedantic -d build/doc/ -c jsdoc.json -r README.md lib/
npx c8 -o build/coverage --temp-dir build/tmp -r html -r text --100 --all --allowExternal --src lib/ --src test/ \
  node --test --test-reporter spec $(node -e 'console.log(process.version < "v22.0.0" ? "test/" : "test/**/*.js")')
if [ ! -d ../gh-pages.gh-pages ]; then git clone -b gh-pages `git config --get remote.origin.url` ../gh-pages.gh-pages; fi
cd ../gh-pages.gh-pages && git pull
rsync -rv --delete --exclude=.git/ build/doc/ ../gh-pages.gh-pages
touch ../gh-pages.gh-pages/.nojekyll
